{% extends "base.html" %}

{% block title %}Network Analytisc{% endblock %}

{% block content_area %}
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Network Analytics</h2>
    
    <!-- Additional Metrics -->
    <div class="flex items-center space-x-6 mb-6 text-gray-700">
        <div class="flex items-center space-x-2">
            <span class="font-semibold">Threat Level:</span>
            <span id="threat-level" class="text-green-500 font-semibold">Safe</span>
        </div>
        <div class="flex items-center space-x-2">
            <span class="font-semibold">Bandwidth:</span>
            <span id="bandwidth">100 Mbps</span>
        </div>
        <div class="flex items-center space-x-2">
            <span class="font-semibold">Avg Connection Rate:</span>
            <span id="avg-connection-rate">500 conn/s</span>
        </div>
        <div class="flex items-center space-x-2">
            <span class="font-semibold">Capturing from:</span>
            <strong id="dstIpDisplay">-</strong>
        </div>
    </div>
    
    <!-- Analytics Panels -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- CPU, RAM, and Swap Usage -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <h3 class="text-lg font-semibold mb-4">Client Machine Status</h3>
            <div>
                <p>CPU Usage: <span id="cpu-usage">45%</span></p>
                <p>RAM Usage: <span id="ram-usage">3.2 GB</span></p>
                <p>Swap Usage: <span id="swap-usage">1.5 GB</span></p>
            </div>
        </div>
    
        <!-- Network Traffic Graph -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <h3 class="text-lg font-semibold mb-4">Request Per Second</h3>
            <canvas id="requestGraph"></canvas>
        </div>
    
        <!-- Protocol Breakdown Pie Chart -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <h3 class="text-lg font-semibold mb-4">Protocol Traffic Breakdown</h3>
            <canvas id="protocolChart"></canvas>
        </div>
    </div>
    
    <!-- Attack History -->
    <div class="mt-8">
        <h3 class="text-xl font-semibold mb-4">Recent Attack History</h3>
        <table class="min-w-full bg-white shadow-lg rounded-lg">
            <thead>
                <tr class="border-b">
                    <th class="p-4 text-left font-semibold">Attack Type</th>
                    <th class="p-4 text-left font-semibold">Time Period</th>
                    <th class="p-4 text-left font-semibold">Downtime</th>
                    <th class="p-4 text-left font-semibold">Overcome Time</th>
                </tr>
            </thead>
            <tbody id="attack-history">
                <tr>
                    <td class="p-4">DDoS</td>
                    <td class="p-4">3 min</td>
                    <td class="p-4">1 min</td>
                    <td class="p-4">4 min</td>
                </tr>
                <!-- Additional rows will be added dynamically -->
            </tbody>
        </table>
    </div>
{% endblock %}

{% block script_area %}
    <!-- Socket.io and Chart.js for real-time data handling -->
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize charts with Chart.js
        const requestGraphCtx = document.getElementById('requestGraph').getContext('2d');
        const protocolChartCtx = document.getElementById('protocolChart').getContext('2d');

        const requestGraph = new Chart(requestGraphCtx, {
            type: 'line',
            data: {
                labels: Array.from({ length: 20 }, (_, i) => i + 1), // Sample labels
                datasets: [{ label: 'Requests per second', data: [30, 50, 60, 70, 90, 100, 110, 130, 125], borderColor: '#4F46E5', fill: false }]
            }
        });

        const protocolChart = new Chart(protocolChartCtx, {
            type: 'pie',
            data: {
                labels: ['HTTP', 'HTTPS', 'FTP', 'Other'],
                datasets: [{ data: [55, 25, 10, 10], backgroundColor: ['#4F46E5', '#1D4ED8', '#A5B4FC', '#DBEAFE'] }]
            }
        });
    </script>
{% endblock %}